<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Risk Calculator</title>
  <!-- Chart.js core -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js financial plugin for candlesticks -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 500px; margin: auto; }
    input, select, button { width: 100%; padding: 8px; margin: 6px 0; }
    canvas { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Trading Risk Calculator</h2>

    <label for="symbol">Market Symbol:</label>
    <input list="symbols" id="symbol" placeholder="Enter market symbol">
    <datalist id="symbols">
      <!-- Forex majors -->
      <option value="EURUSD">
      <option value="GBPUSD">
      <option value="USDJPY">
      <option value="USDCHF">
      <option value="AUDUSD">
      <option value="USDCAD">
      <option value="NZDUSD">

      <!-- Commodities -->
      <option value="XAUUSD"> <!-- Gold -->
      <option value="XAGUSD"> <!-- Silver -->
      <option value="WTIUSD"> <!-- Crude Oil -->
      <option value="NGAS">   <!-- Natural Gas -->

      <!-- Indices -->
      <option value="US30">
      <option value="NAS100">
      <option value="SPX500">

      <!-- Crypto -->
      <option value="BTCUSD">
      <option value="ETHUSD">
      <option value="BNBUSD">
      <option value="XRPUSD">

      <!-- Stocks -->
      <option value="AAPL">
      <option value="TSLA">
      <option value="AMZN">
      <option value="MSFT">
      <option value="GOOGL">
    </datalist>

    <label for="accountSize">Account Size ($):</label>
    <input type="number" id="accountSize" placeholder="e.g. 10000">

    <label for="riskPercent">Risk % per Trade:</label>
    <input type="number" id="riskPercent" placeholder="e.g. 1">

    <label for="entry">Entry Price:</label>
    <input type="number" id="entry" placeholder="e.g. 1950">

    <label for="stop">Stop Loss Price:</label>
    <input type="number" id="stop" placeholder="e.g. 1940">

    <label for="target">Target Price:</label>
    <input type="number" id="target" placeholder="e.g. 1970">

    <button onclick="calculate()">Calculate</button>
    <button onclick="exportCSV()">Export MT5 Order (CSV)</button>

    <h3>Result:</h3>
    <pre id="result"></pre>

    <canvas id="chart" width="400" height="200"></canvas>
  </div>

  <script>
    function getLotSize(symbol, units) {
      symbol = symbol.toUpperCase();

      if (symbol.includes("USD") && symbol.length === 6) {
        // Forex pairs like EURUSD
        return units / 100000;
      } else if (symbol === "XAUUSD") {
        // Gold
        return units / 100;
      } else if (symbol === "XAGUSD") {
        // Silver
        return units / 5000;
      } else if (symbol.includes("WTI") || symbol.includes("OIL")) {
        // Crude Oil
        return units / 1000;
      } else if (["BTCUSD", "ETHUSD", "BNBUSD", "XRPUSD"].includes(symbol)) {
        // Crypto
        return units / 1;
      } else {
        // Stocks or fallback
        return units / 1;
      }
    }

    function calculate() {
      let symbol = document.getElementById("symbol").value;
      let accountSize = parseFloat(document.getElementById("accountSize").value);
      let riskPercent = parseFloat(document.getElementById("riskPercent").value);
      let entry = parseFloat(document.getElementById("entry").value);
      let stop = parseFloat(document.getElementById("stop").value);
      let target = parseFloat(document.getElementById("target").value);

      if (isNaN(accountSize) || isNaN(riskPercent) || isNaN(entry) || isNaN(stop) || isNaN(target)) {
        alert("Please fill in all fields.");
        return;
      }

      let riskAmount = accountSize * (riskPercent / 100);
      let stopDistance = Math.abs(entry - stop);
      let unitSize = riskAmount / stopDistance;
      let lotSize = getLotSize(symbol, unitSize);

      document.getElementById("result").innerText =
        `Symbol: ${symbol}
Risk Amount: $${riskAmount.toFixed(2)}
Position Size: ${unitSize.toFixed(2)} units
console.log("DEBUG:", symbol, "Units:", unitSize, "Lots:", lotSize);
Lot Size: ${lotSize.toFixed(7)} lots`;

      drawChart(entry, stop, target);
    }

    function drawChart(entry, stop, target) {
      const ctx = document.getElementById("chart").getContext("2d");
      if (window.tradeChart) window.tradeChart.destroy();

      // Generate 20 random candles around entry
      let candles = [];
      let base = entry;
      for (let i = 0; i < 20; i++) {
        let open = base + (Math.random() - 0.5) * 5;
        let close = open + (Math.random() - 0.5) * 5;
        let high = Math.max(open, close) + Math.random() * 2;
        let low = Math.min(open, close) - Math.random() * 2;
        candles.push({ x: i, o: open, h: high, l: low, c: close });
        base = close;
      }

      window.tradeChart = new Chart(ctx, {
        type: "candlestick",
        data: {
          datasets: [{
            label: "Price",
            data: candles
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { type: "linear" },
            y: { beginAtZero: false }
          },
          plugins: {
            annotation: {
              annotations: {
                entry: {
                  type: "line",
                  yMin: entry,
                  yMax: entry,
                  borderColor: "green",
                  borderWidth: 2,
                  label: { content: "Entry", enabled: true }
                },
                stop: {
                  type: "line",
                  yMin: stop,
                  yMax: stop,
                  borderColor: "red",
                  borderWidth: 2,
                  label: { content: "Stop", enabled: true }
                },
                target: {
                  type: "line",
                  yMin: target,
                  yMax: target,
                  borderColor: "orange",
                  borderWidth: 2,
                  label: { content: "Target", enabled: true }
                }
              }
            }
          }
        }
      });
    }

    function exportCSV() {
      let symbol = document.getElementById("symbol").value;
      let accountSize = parseFloat(document.getElementById("accountSize").value);
      let riskPercent = parseFloat(document.getElementById("riskPercent").value);
      let entry = parseFloat(document.getElementById("entry").value);
      let stop = parseFloat(document.getElementById("stop").value);
      let target = parseFloat(document.getElementById("target").value);

      let riskAmount = accountSize * (riskPercent / 100);
      let stopDistance = Math.abs(entry - stop);
      let unitSize = riskAmount / stopDistance;
      let lotSize = getLotSize(symbol, unitSize);

      let csvContent = "data:text/csv;charset=utf-8,"
        + "Symbol,Entry,StopLoss,Target,Units,Lots\n"
        + `${symbol},${entry},${stop},${target},${unitSize.toFixed(2)},${lotSize.toFixed(2)}\n`;

      let link = document.createElement("a");
      link.setAttribute("href", encodeURI(csvContent));
      link.setAttribute("download", "mt5_order.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>

